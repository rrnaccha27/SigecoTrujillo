@model SIGEES.Web.Areas.Comision.Models.PlanillaViewModel
@{
    int codigo_planilla = Model.planilla.codigo_planilla;
    string fecha_actual = DateTime.Now.ToShortDateString();

}

<div class="easyui-layout" data-options="fit:true">
    <div data-options="region:'north', border:false" style="padding:5px 5px 0px 5px;height:225px;">
        <div class="easyui-layout" data-options="fit:true">
            <div data-options="region:'center',border:false" style="width:100%">
                <div class="easyui-layout" data-options="fit:true">
                    <div class="easyui-panel" title="Datos Generales" style="width: 99%; ">
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">N&uacute;mero Planilla</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            <input class="easyui-textbox" type="text" value="@Model.planilla.numero_planilla" style="width: 100%;" data-options="disabled:true" id="txt_numero_planilla" />
                        </div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Planilla</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            @if (codigo_planilla > 0)
                        {
                            <input id="cmb_regla_tipo_planilla" value="@Model.planilla.codigo_regla_tipo_planilla" class="easyui-combobox" style="width:100%;" data-options="required:true,novalidate:true,editable:false,disabled:true">
                        }
                        else
                        {
                            <input id="cmb_regla_tipo_planilla" class="easyui-combobox" style="width:100%;" data-options="required:true,novalidate:true,editable:false">
                        }
                        </div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Tipo Planilla</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">

                            <input id="cmb_tipo_planilla" value="@Model.planilla.codigo_tipo_planilla" class="easyui-combobox" style="width:100%;" data-options="required:true,novalidate:true,editable:false,disabled:true">

                        </div>
                        <!--segunda linea-->
                        <div class="rowBoth"></div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Fecha Inicio</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            @if (codigo_planilla > 0)
                        {
                            <input class="easyui-datebox" type="text" value="@Model.planilla.fecha_inicio" style="width: 100%;"
                                   data-options="required:true,disabled:true,novalidate:true,validType:'fechaMenorAHoyYMenorA[\'#dtp_fecha_fin\',\'Fecha Fin\',\'dd/MM/yyyy\']'" id="dtp_fecha_inicio" />
                        }
                        else
                        {

                            <input class="easyui-datebox" type="text" style="width: 100%;"
                                   data-options="required:true,editable: false,novalidate:true,validType:'fechaMenorAHoyYMenorA[\'#dtp_fecha_fin\',\'Fecha Fin\',\'dd/MM/yyyy\']'" id="dtp_fecha_inicio" />

                        }
                        </div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Fecha Fin</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            @if (codigo_planilla > 0)
                        {
                            <input class="easyui-datebox" type="text" value="@Model.planilla.fecha_fin" style="width: 100%;"
                                   data-options="required:true,disabled:true,novalidate:true,validType:'MenorIgualAHoy[\'dd/MM/yyyy\',\'#dtp_fecha_fin\']'" id="dtp_fecha_fin" />
                        }
                        else
                        {
                            <input class="easyui-datebox" type="text" value="@fecha_actual" style="width: 100%;"
                                   data-options="required:true,editable: false,novalidate:true,validType:'MenorIgualAHoy[\'dd/MM/yyyy\',\'#dtp_fecha_fin\']'" id="dtp_fecha_fin" />
                        }
                        </div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Estado</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            <input class="easyui-textbox" type="text" value="@Model.planilla.estado_planilla.nombre" style="width: 100%;" data-options="disabled:true" />
                        </div>
                    </div>
                    <div class="easyui-panel" title="Datos de Auditoria" style="width: 99%; ">
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Fecha Apertura</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            <input class="easyui-textbox" type="text" value="@Model.planilla.fecha_apertura.ToString("dd/MM/yyyy HH:mm:ss")" style="width: 100%;" data-options="disabled:true" />
                        </div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Usuario</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:40%;">
                            <input class="easyui-textbox" type="text" value="@Model.planilla.usuario_apertura" style="width: 100%;" data-options="disabled:true" />
                        </div>
                        <!--segunda linea-->
                        <div class="rowBoth"></div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Fecha Cierre</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            @{

                            string v_fecha_cierre = Model.planilla.fecha_cierre == null ? "" : DateTime.Parse(Model.planilla.fecha_cierre.ToString()).ToString("dd/MM/yyyy HH:mm:ss");

                            }
                            <input class="easyui-textbox" type="text" value="@v_fecha_cierre" style="width: 100%;" data-options="disabled:true" />
                        </div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Usuario</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:40%;">
                            <input class="easyui-textbox" type="text" value="@Model.planilla.usuario_cierre" style="width: 100%;" data-options="disabled:true" />
                        </div>
                    </div>
                </div>
            </div>
            <div data-options="region:'east',border:false" style="width:200px">
                <div class="easyui-panel" title="Opciones" style="width: 98%; ">
                    @*<a href="javascript:fnExportarPlanilla(@Model.planilla.codigo_planilla);" class="easyui-linkbutton" iconcls="icon-print" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%">Reporte</a>*@
                    <a href="javascript:fnReporteLiquidacion(@Model.planilla.codigo_planilla);" class="easyui-linkbutton" iconcls="icon-print" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%">Liquidaciones</a>
                    <a href="javascript:cerrar_planilla();" class="easyui-linkbutton" iconcls="icon-undo" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%">Salir</a>
                </div>
            </div>
        </div>
    </div>
    <div data-options="region:'center',border:false" style="padding:0px 5px 5px 5px;">
        <div class="easyui-panel" title="Detalle Planilla" style="height:100%;">
            <table id="dgv_planilla_comercial_pago_habilitado" style="width:100%;height:100%"></table>
        </div>
    </div>
</div>

<div id="div_reporte_general" class="easyui-dialog" data-options="resizable:true,modal:true,closed:true"
     style="width: 100%; height: 100%;line-height: 20px;"></div>

<script type="text/javascript" src="~/Areas/Comision/Scripts/Views/PlanillaComercial/planilla_comercial.planilla.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var actionUrls =
        {
            _Reporte: '@Url.Action("_Reporte", "Planilla", new { area = "Comision" })',
            _Reporte_Liquidacion: '@Url.Action("_Liquidacion", "PlanillaComercial", new { area = "Comision" })',
            _Exportar: '@Url.Action("_Exportar", "PlanillaComercial", new { area = "Comision" })',
            _GetReglaTipoPlanillaJson: '@Url.Action("GetComboReglaTipoPlanillaAllJson", "PlanillaComercial", new { area = string.Empty })',
            _GetTipoPlanillaJson: '@Url.Action("GetTipoPlanillaJson", "Planilla", new { area = string.Empty })',
            _GetPagoHabilitadoJson: '@Url.Action("GetPagosHabilitadoJson", "PlanillaComercial", new { area = string.Empty })',
            _codigo_planilla: '@codigo_planilla',
            _numero_planilla: '@Model.planilla.numero_planilla'
        };
        project.planilla.Initialize(actionUrls);
    });
</script>