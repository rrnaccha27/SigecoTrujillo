@model SIGEES.Web.Areas.Comision.Models.PlanillaViewModel
@{
    int codigo_planilla = Model.planilla_bono.codigo_planilla;
    string fecha_actual = DateTime.Now.ToShortDateString();
    string tituloAuditoria = "";
    string fechaAuditoria = "";
    string usuarioAuditoria = "";
    if (Model.planilla_bono.codigo_estado_planilla == (int)SIGEES.Web.Areas.Comision.Utils.EstadoPlanilla.anulado)
    {
        tituloAuditoria = "Anulación";
        fechaAuditoria = Model.planilla_bono.fecha_anulacion == null ? "" : DateTime.Parse(Model.planilla_bono.fecha_anulacion.ToString()).ToString("dd/MM/yyyy HH:mm:ss"); ;
        usuarioAuditoria = Model.planilla_bono.usuario_anulacion;
    }
    else if (Model.planilla_bono.codigo_estado_planilla == (int)SIGEES.Web.Areas.Comision.Utils.EstadoPlanilla.cerrado)
    {
        tituloAuditoria = "Cierre";
        fechaAuditoria = Model.planilla_bono.fecha_cierre == null ? "" : DateTime.Parse(Model.planilla_bono.fecha_cierre.ToString()).ToString("dd/MM/yyyy HH:mm:ss"); ;
        usuarioAuditoria = Model.planilla_bono.usuario_cierre;
    }
    else
    {
        tituloAuditoria = "Cierre";
    }
}

<div class="easyui-layout" data-options="fit:true">
    <div data-options="region:'north', border:false" style="padding:5px 5px 0px 5px;height:223px;">
        <div class="easyui-layout" data-options="fit:true">
            <div data-options="region:'center',border:false" style="width:100%">
                <div class="easyui-layout" data-options="fit:true">
                    <div class="easyui-panel" title="Datos Generales" style="width: 99%; ">
                        <form id="fmr_registrar_planilla">
                            <div class="rowGridModalDouble" style="width:12%;">
                                <label class="colGridModal">N&uacute;mero Planilla</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:15%;">
                                <input class="easyui-textbox" type="text" value="@Model.planilla_bono.numero_planilla" style="width: 100%;" data-options="disabled:true" id="txt_numero_planilla" />
                            </div>
                            <div class="rowGridModalDouble" style="width:12%;">
                                <label class="colGridModal">Canal de Venta</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:17%;">
                                @if (codigo_planilla > 0)
                                {
                                    <input id="cmb_canal_venta" value="@Model.planilla_bono.codigo_canal" class="easyui-combobox" style="width:100%;" data-options="required:true,novalidate:true,editable:false,disabled:true">
                                }
                                else
                                {
                                    <input id="cmb_canal_venta" class="easyui-combobox" style="width:100%;" data-options="required:true,novalidate:true,editable:false">
                                }
                            </div>
                            <div class="rowGridModalDouble" style="width:11%;">
                                <label class="colGridModal">Tipo</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:15%;">
                                @if (codigo_planilla > 0)
                                {
                                    <input id="cmb_tipo_planilla" value="@Model.planilla_bono.codigo_tipo_planilla" class class="easyui-combobox" style="width:100%;" data-options="required:true,novalidate:true,editable:false,disabled:true">
                                }
                                else
                                {
                                    <input id="cmb_tipo_planilla" class="easyui-combobox" style="width:100%;" data-options="required:true,novalidate:true,editable:false">
                                }
                            </div>

                            <!--segunda linea-->
                            <div class="rowBoth"></div>
                            <div class="rowGridModalDouble" style="width:12%;">
                                <label class="colGridModal">Fecha Inicio</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:15%;">
                                @if (codigo_planilla > 0)
                                {
                                    <input class="easyui-datebox" type="text" value="@Model.planilla_bono.fecha_inicio" style="width: 100%;"
                                           data-options="required:true,editable: false,disabled:true,novalidate:true,validType:'fechaMenorAHoyYMenorA[\'#dtp_fecha_fin\',\'Fecha Fin\',\'dd/MM/yyyy\']'" id="dtp_fecha_inicio" />
                                }
                                else
                                {

                                    <input class="easyui-datebox" type="text" style="width: 100%;"
                                           data-options="required:true,editable: false,novalidate:true,validType:'fechaMenorAHoyYMenorA[\'#dtp_fecha_fin\',\'Fecha Fin\',\'dd/MM/yyyy\']'" id="dtp_fecha_inicio" />

                                }
                            </div>
                            <div class="rowGridModalDouble" style="width:12%;">
                                <label class="colGridModal">Fecha Fin</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:17%;">
                                @if (codigo_planilla > 0)
                                {
                                    <input class="easyui-datebox" type="text" value="@Model.planilla_bono.fecha_fin" style="width: 100%;"
                                           data-options="required:true,disabled:true,novalidate:true,validType:'MenorIgualAHoy[\'dd/MM/yyyy\',\'#dtp_fecha_fin\']'" id="dtp_fecha_fin" />
                                }
                                else
                                {
                                    <input class="easyui-datebox" type="text" value="@fecha_actual" style="width: 100%;"
                                           data-options="required:true,editable: false,novalidate:true" id="dtp_fecha_fin" />
                                }


                            </div>
                            <div class="rowGridModalDouble" style="width:11%;">
                                <label class="colGridModal">Estado</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:15%;">
                                @if (codigo_planilla > 0)
                                {
                                    <input class="easyui-textbox" type="text" value="@Model.planilla_bono.estado_planilla.nombre" style="width: 100%;" data-options="disabled:true" />
                                }
                                else
                                {

                                    <input class="easyui-textbox" type="text" value="Abierto" style="width: 100%;" data-options="disabled:true" />
                                }

                            </div>
                        </form>
                    </div>
                    <div class="easyui-panel" title="Datos de Auditoria" style="width: 99%; ">
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Fecha Apertura</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            <input class="easyui-textbox" type="text" value="@Model.planilla_bono.fecha_apertura.ToString("dd/MM/yyyy HH:mm:ss")" style="width: 100%;" data-options="disabled:true" />
                        </div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Usuario</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:40%;">
                            <input class="easyui-textbox" type="text" value="@Model.planilla_bono.usuario_apertura" style="width: 100%;" data-options="disabled:true" />
                        </div>
                        <!--segunda linea-->
                        <div class="rowBoth"></div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Fecha @tituloAuditoria</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            <input class="easyui-textbox" type="text" value="@fechaAuditoria" style="width: 100%;" data-options="disabled:true" />
                        </div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Usuario</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:40%;">
                            <input class="easyui-textbox" type="text" value="@usuarioAuditoria" style="width: 100%;" data-options="disabled:true" />
                        </div>
                    </div>
                </div>
            </div>
            <div data-options="region:'east',border:false" style="width:200px">
                <div class="easyui-panel" title="Opciones" style="width: 98%; ">
					<a href="javascript:fnReporteResumen(@Model.planilla_bono.codigo_planilla);" class="easyui-linkbutton" iconcls="icon-print" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%;">Reporte Resúmen</a>
					<a href="javascript:fnReporteLiquidacion(@Model.planilla_bono.codigo_planilla);" class="easyui-linkbutton" iconcls="icon-print" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%;">Reporte Liquidación</a>
                    <a href="javascript:cerrar_planilla();" class="easyui-linkbutton" iconcls="icon-undo" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%">Salir</a>
                </div>
            </div>
        </div>
    </div>
    <div data-options="region:'center',border:false" style="padding:0px 5px 5px 5px;">
        <div class="easyui-panel" title="Detalle Planilla" style="height: 100%;">
            <div class="easyui-tabs" style="height:100%">
                <div title="Pagos Habilitados" style="padding:3px">
                    <table id="dgv_planilla_pago_habilitado" style="width:100%;height:100%"></table>
                </div>
                <div title="Exclusiones" style="padding:3px">
                    <table id="dgv_planilla_pago_excluido" style="width:100%;height:100%"></table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="div_reporte_general" class="easyui-dialog" data-options="resizable:true,modal:true,closed:true"
     style="width: 100%; height: 100%;line-height: 20px;"></div>

<script type="text/javascript" src="~/Areas/Comision/Scripts/Views/PlanillaBono/planilla.planilla.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var actionUrls =
        {
            _GetReglaTipoPlanillaJson: '@Url.Action("GetComboReglaTipoPlanillaAllJson", "PlanillaBono", new { area = "Comision" })',
            _Reporte_Planilla: '@Url.Action("_Reporte_Planilla", "PlanillaBono", new { area = "Comision" })',
            _Reporte_Liquidacion: '@Url.Action("_Reporte_Liquidacion", "PlanillaBono", new { area = "Comision" })',
            _Reporte_Liquidacion_individual: '@Url.Action("_Reporte_Liquidacion_individual", "PlanillaBono", new { area = "Comision" })',

            _GetTipoPlanillaJson: '@Url.Action("GetTipoPlanillaJson", "Planilla", new { area = "Comision" })',
            _GetCanalJson: '@Url.Action("GetCanalJson", "PlanillaBono", new { area = "Comision" })',
            _GetPagoHabilitadoJson: '@Url.Action("GetPagosHabilitadosJson", "PlanillaBono", new { area = "Comision" })',
            _GetPagoExcluidoJson: '@Url.Action("GetPagosExcluidosJson", "PlanillaBono", new { area = "Comision" })',
            _codigo_planilla: '@codigo_planilla',
            _codigo_tipo_planilla: '@Model.planilla_bono.codigo_tipo_planilla',
            _es_consulta: '1'
        };
        project.planilla.Initialize(actionUrls);
    });
</script>
