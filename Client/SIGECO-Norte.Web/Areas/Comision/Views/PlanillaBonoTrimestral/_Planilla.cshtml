@model SIGEES.Web.Areas.Comision.Models.PlanillaViewModel
@using SIGEES.Web.Areas.Comision.Utils;
@{
    int codigo_planilla = Model.planilla_bono_trimestral.codigo_planilla;
    string fecha_actual = DateTime.Now.ToShortDateString();
    string tituloAuditoria = "";
    string fechaAuditoria = "";
    string usuarioAuditoria = "";
    string codigo_tipo_planilla = "1";
    string codigo_regla = "";
    string codigo_periodo = "";
    string combo_option = "required:true,novalidate:true,editable:false";
    
    if (Model.planilla_bono_trimestral.codigo_estado_planilla == (int)SIGEES.Web.Areas.Comision.Utils.EstadoPlanilla.anulado)
    {
        tituloAuditoria = "Anulación";
        fechaAuditoria = Model.planilla_bono_trimestral.fecha_anulacion == null ? "" : DateTime.Parse(Model.planilla_bono_trimestral.fecha_anulacion.ToString()).ToString("dd/MM/yyyy HH:mm:ss"); ;
        usuarioAuditoria = Model.planilla_bono_trimestral.usuario_anulacion;
    }
    else if (Model.planilla_bono_trimestral.codigo_estado_planilla == (int)SIGEES.Web.Areas.Comision.Utils.EstadoPlanilla.cerrado)
    {
        tituloAuditoria = "Cierre";
        fechaAuditoria = Model.planilla_bono_trimestral.fecha_cierre == null ? "" : DateTime.Parse(Model.planilla_bono_trimestral.fecha_cierre.ToString()).ToString("dd/MM/yyyy HH:mm:ss"); ;
        usuarioAuditoria = Model.planilla_bono_trimestral.usuario_cierre;
    }
    else
    {
        tituloAuditoria = "Cierre";
    }

    if (Model.planilla_bono_trimestral.codigo_planilla > 0)
    { 
        codigo_regla = Model.planilla_bono_trimestral.codigo_regla.ToString();
        codigo_periodo = Model.planilla_bono_trimestral.codigo_periodo.ToString();
        combo_option = combo_option + ",disabled:true";
    }
}

<div class="easyui-layout" data-options="fit:true">
    <div data-options="region:'north', border:false" style="padding:5px 5px 0px 5px;height:223px;">
        <div class="easyui-layout" data-options="fit:true">
            <div data-options="region:'center',border:false" style="width:100%">
                <div class="easyui-layout" data-options="fit:true">
                    <div class="easyui-panel" title="Datos Generales" style="width: 99%; ">
                        <form id="fmr_registrar_planilla">
                            <div class="rowGridModalDouble" style="width:12%;">
                                <label class="colGridModal">N&uacute;mero Planilla</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:15%;">
                                <input class="easyui-textbox" type="text" value="@Model.planilla_bono_trimestral.numero_planilla" style="width: 100%;" data-options="disabled:true" id="txt_numero_planilla" />
                            </div>
                            <div class="rowGridModalDouble" style="width:12%;">
                                <label class="colGridModal">Regla Bono</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:17%;">
                                <input id="cmb_regla" value="@codigo_regla" class="easyui-combobox" style="width:100%;" data-options="@combo_option">
                            </div>
                            <div class="rowGridModalDouble" style="width:11%;">
                                <label class="colGridModal">Periodo</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:15%;">
                                <input id="cmb_periodo" value="@codigo_periodo" class="easyui-combobox" style="width:100%;" data-options="@combo_option">
                            </div>

                            <!--segunda linea-->
                            <div class="rowBoth"></div>
                            <div class="rowGridModalDouble" style="width:12%;">
                                <label class="colGridModal">Tipo</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:15%;">
                                <input id="cmb_tipo_planilla" value="@codigo_tipo_planilla" class="easyui-combobox" style="width:100%;" data-options="required:true,novalidate:true,editable:false,disabled:true">
                            </div>
                            <div class="rowGridModalDouble" style="width:12%;">
                                <label class="colGridModal">Estado</label>
                            </div>
                            <div class="rowGridModalDouble" style="width:17%;">
                                @if (codigo_planilla > 0)
                                {
                                    <input class="easyui-textbox" type="text" value="@Model.planilla_bono_trimestral.estado_planilla.nombre" style="width: 100%;" data-options="disabled:true" />
                                }
                                else
                                {

                                    <input class="easyui-textbox" type="text" value="Abierto" style="width: 100%;" data-options="disabled:true" />
                                }

                            </div>
                        </form>
                    </div>
                    <div class="easyui-panel" title="Datos de Auditoria" style="width: 99%; ">
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Fecha Apertura</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            <input class="easyui-textbox" type="text" value="@Model.planilla_bono_trimestral.fecha_apertura.ToString("dd/MM/yyyy HH:mm:ss")" style="width: 100%;" data-options="disabled:true" />
                        </div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Usuario</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:40%;">
                            <input class="easyui-textbox" type="text" value="@Model.planilla_bono_trimestral.usuario_apertura" style="width: 100%;" data-options="disabled:true" />
                        </div>
                        <!--segunda linea-->
                        <div class="rowBoth"></div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Fecha @tituloAuditoria</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:15%;">
                            <input class="easyui-textbox" type="text" value="@fechaAuditoria" style="width: 100%;" data-options="disabled:true" />
                        </div>
                        <div class="rowGridModalDouble" style="width:12%;">
                            <label class="colGridModal">Usuario</label>
                        </div>
                        <div class="rowGridModalDouble" style="width:40%;">
                            <input class="easyui-textbox" type="text" value="@usuarioAuditoria" style="width: 100%;" data-options="disabled:true" />
                        </div>
                    </div>
                </div>
            </div>
            <div data-options="region:'east',border:false" style="width:200px">
                <div class="easyui-panel" title="Opciones" style="width: 98%; ">
                    @{
                        if (codigo_planilla <= 0)
                        {
                            <a href="javascript:RegistrarPlanilla();" class="easyui-linkbutton" iconcls="icon-gear" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%">Aperturar</a>
                        }
                        else
                        {
                            <a href="#" class="easyui-menubutton" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%;" data-options="menu:'#mnuReportesBono',iconCls:'icon-print'">Reportes</a>
                            if ((Model.planilla_bono_trimestral.codigo_estado_planilla != (int)SIGEES.Web.Areas.Comision.Utils.EstadoPlanilla.anulado))
                            {
                                <a href="javascript:fnEnviarLiquidacion();" class="easyui-linkbutton" iconcls="icon-email" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%;">Correo Liquidaciones</a>
                            }
                            if ((Model.planilla_bono_trimestral.codigo_estado_planilla == (int)SIGEES.Web.Areas.Comision.Utils.EstadoPlanilla.abierto) && (Model.bean.estadoEscritura != null && Model.bean.estadoEscritura.CompareTo("A") == 0))
                            {
                                <a href="javascript:CerrarPlanilla(@Model.planilla_bono_trimestral.codigo_planilla);" class="easyui-linkbutton" iconcls="icon-ok" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%">Cerrar Planilla</a>
                                <a href="javascript:AnularPlanilla(@Model.planilla_bono_trimestral.codigo_planilla);" class="easyui-linkbutton" iconcls="icon-cancel" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%">Anular</a>
                            }
                        }
                    }
                    <a href="javascript:cerrar_planilla();" class="easyui-linkbutton" iconcls="icon-undo" style="text-align: left; padding: 2px 0px 2px 15px; width: 99%">Salir</a>
                </div>
            </div>
        </div>
    </div>
    <div data-options="region:'center',border:false" style="padding:0px 5px 5px 5px;">
        <div class="easyui-panel" title="Detalle Planilla" style="height: 100%;">

            <div class="easyui-tabs" style="height:100%">
                <div title="Pagos Habilitados" style="padding:3px">
                    <table id="dgv_planilla_pago_habilitado" style="width:100%;height:100%"></table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="div_reporte_general" class="easyui-dialog" data-options="resizable:true,modal:true,closed:true"
     style="width: 100%; height: 100%;line-height: 20px;"></div>

<div id="mnuReportesBono" class="easyui-menu">
    <div onclick="fnReporte(@Convert.ToString(((int)ReporteBonoTrimestral.planilla)));">Planilla</div>
    <div onclick="fnReporte(@Convert.ToString(((int)ReporteBonoTrimestral.liquidacion)));">Liquidación</div>
    <div onclick="fnReporte(@Convert.ToString(((int)ReporteBonoTrimestral.resumen_liquidacion)));">Resúmen Liquidación</div>
</div>

<script type="text/javascript" src="~/Areas/Comision/Scripts/Views/PlanillaBonoTrimestral/planilla.planilla.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var actionUrls =
        {
            _Registrar: '@Url.Action("Registrar", "PlanillaBonoTrimestral", new { area = "Comision" })',
            _Anular: '@Url.Action("Anular", "PlanillaBonoTrimestral", new { area = "Comision" })',
            _Cerrar: '@Url.Action("Cerrar", "PlanillaBonoTrimestral", new { area = "Comision" })',

            _Reporte: '@Url.Action("_Reporte", "PlanillaBonoTrimestral", new { area = "Comision" })',
            _Enviar_Correo_Liquidacion: '@Url.Action("_Enviar_Correo_Liquidacion", "PlanillaBonoTrimestral", new { area = "Comision" })',

            _GetTipoPlanillaJson: '@Url.Action("GetTipoPlanillaJson", "Planilla", new { area = "Comision" })',
            _GetReglaJson: '@Url.Action("GetReglaBonoTrimestralJson", "PlanillaBonoTrimestral", new { area = "Comision" })',
            _GetPeriodoJson: '@Url.Action("GetPeriodoTrimestralJson", "PlanillaBonoTrimestral", new { area = "Comision" })',

            _GetPagoHabilitadoJson: '@Url.Action("GetPagosHabilitadosJson", "PlanillaBonoTrimestral", new { area = "Comision" })',

            _codigo_planilla: '@codigo_planilla',
            _codigo_tipo_planilla: '@codigo_tipo_planilla',
            _es_consulta: '0'
        };
        project.planilla.Initialize(actionUrls);
    });
</script>
